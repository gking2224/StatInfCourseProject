---
title: "Analysis of the Variance of Multiple Sample Means"
author: "Graham King"
date: "7 January 2015"
output:
  pdf_document: default
---
```{r opts, echo = FALSE}
library(knitr)
library(markdown)
opts_chunk$set(comment = NA, fig.width = 12, fig.height = 6)
options(encoding = "UTF-8", scipen = 999)
lambda <- 0.2
s <- 40
```

### Overview

$\mu$
The objective of this analysis is to look at the variance and standard error of a simulation of numbers drawn at random from the exponential distribution. This distribution has a number of known properties of the theoretical total population, which this analysis will compare with a sample of simulated data, drawn at random from that distribution.

The exponential distribution is defined by a 'rate parameter', known as 'lambda' (<math display="inline"><mo>LAMBDA</mo></math>). This analysis will use a lambda value of `r lambda`.

It has a mean, or 'mu' (<math display="inline"><mo>&mu;</mo></math>), of <math display="inline"><mfrac bevelled="true"><mrow><mn>1</mn></mrow><mrow><mo>&lambda;</mo></mrow></mfrac></math>.

Its standard deviation, or 'sigma' (<math display="inline"><mo>SIGMA</mo></math>), is also <math display="inline"><mrow><mfrac bevelled="true"><mrow><mn>1</mn></mrow><mrow><mo>LAMBDA</mo></mrow></mfrac></math>, meaning its variance (<math display="inline"><msup><mo>SIGMA</mo><mn>2</mn></msup></math>) is <math display="inline"><msup><mfenced><mfrac bevelled="true"><mrow><mn>1</mn></mrow><mrow><mo>LAMBDA</mo></mrow></mfrac></mfenced><mn>2</mn></msup></math>.

Finally its standard error of the mean, or 'SEM' (<math display="inline"><msub><mo>SIGMA</mo><mover><mi>x</mi><mo>OVERBAR</mo></mover></msub></math>), is <math display="inline"><mfrac bevelled="true"><mrow><mo>SIGMA</mo></mrow><mrow><msqrt><mi>n</mi></msqrt></mrow></mfrac></math>, meaning that a distribution of the means of a number of samples of size *n* should have this standard distribution.

Below is a table of the variables used in this analysis, with their associated mathematical symbols and a description of what it represents:

Variable Name | Mathematical Symbol | Description
------------- | ------------------- | -----------
lambda | <math display="inline"><mo>LAMBDA</mo></math> | rate parameter of the exponential distribution
mu | <math display="inline"><mo>MU</mo></math> | population mean
sigma | <math display="inline"><mo>SIGMA</mo></math> | population standard deviation
sigma2 | <math display="inline"><msup><mo>SIGMA</mo><mn>2</mn></msup></math> | population variance
sem | <math display="inline"><msub><mo>SIGMA</mo><mover><mi>x</mi><mo>OVERBAR</mo></mover></msub></math> | standard error of the mean
xbar | <math display="inline"><mover><mi>x</mi><mo>OVERBAR</mo></mover></math> | sample mean
s2 | <math display="inline"><msup><mi>s</mi><mn>2</mn></msup></math> | sample variance
muxbar | <math display="inline"><msub><mo>MU</mo><mover><mi>x</mi><mo>OVERBAR</mo></mover></msub></math> | mean of sample means
s2xbar | <math display="inline"><msubsup><mi>s</mi><mover><mi>x</mi><mo>OVERBAR</mo></mover><mn>2</mn></msubsup></math> | variance of sample means 
sxbar | <math display="inline"><msub><mi>s</mi><mover><mi>x</mi><mo>OVERBAR</mo></mover></msub></math> | standard deviation of sample means 


### Simulation
First I will set the rate parameter and the distribution's theoretical statistics:
```{r intro}
lambda <- 0.2
mu <- 1 / lambda
sigma <- 1 / lambda
sigma2 <- sigma^2

n <- 40             # size of each simulation
numsims <- 1000     # number of simulations
sem <- sigma / sqrt(n)

print(data.frame(mean = mu, sd = sigma, variance = sigma2, sem = sem))

```

### Single Sample
Here I take a random sample of `r n * numsims` variables from the exponential distribution. These same values will split later into groups of `r n` for multiple sample means to be taken, but here I plot all the distribution of all of the sampled values.
```{r expSample}
set.seed(20150109)

sample <- rexp(n * numsims, lambda)
xbar <- sum(sample) / length(sample) # mean(sample)
s2 <- sum( (sample - xbar)^2) / (length(sample) - 1) # var(sample)

library(ggplot2)
g1  <- ggplot(
    data = data.frame(x = sample), aes(x = x)) +
    geom_density(size = 2, alpha = 0.2, fill = "red") +
    geom_vline(
        size = 2,
        alpha = 0.5,
        xintercept = c(mu, xbar, sigma2, s2),
        colour = c("red", "blue", "green4", "gold4"),
        lty = c(1, 2, 1, 2)) +
    annotate(
        "text",
        size = 4,
        alpha = 0.8,
        label = c(
            paste0("Population Mean (", mu, ")"),
            paste0("Sample\nMean\n(", round(xbar, 3), ")"),
            paste0("Population Variance (", round(sigma2, 3), ")"),
            paste0("Sample Variance (", round(s2, 3), ")")),
        x = c(mu, xbar, sigma2, s2),
        y = c(0.1, 0.05, 0.05, 0.03),
        hjust = -c(
            0.06, -1.06,
            0.06,
            -1.06),
        colour = c("red", "blue", "green4", "gold4")) +
    ggtitle(paste(
        "Figure 1: Density of", length(sample),
        "rexp variables (lambda=", lambda, ")")) +
    theme(plot.title = element_text(size = rel(2)))

print(g1)

```
Figure 1 demonstrates that the mean of this sample (`r xbar`) is very close to the theoretical mean of the whole population (`r mu`) and that the sample variance (`r s2`) is similarly very close to the population variance (`r sigma2`).

### Distribution of Sample Means
I next split this sample of `r 40000` into `r numsims` groups of `r n` (n) and take the mean of each sample. I then plot the distribution of these sample means and compare its standard deviation with the population 'standard error of the mean' (sem); and also its mean with the population theoretical mean.
```{r means}
smp.means <- apply(matrix(sample, numsims), 1, mean)

muxbar <- sum(smp.means) / numsims # mean(smp.means)
s2xbar <- sum( (smp.means - muxbar)^2 ) / (numsims - 1) # var(smp.means)
sxbar <- sqrt(s2xbar)

g2 <- ggplot(data = data.frame(x = smp.means), aes(x = x)) +
    geom_density(alpha = 0.2, size = 2, fill = "red") +
    geom_vline(
        size = 2, alpha = 0.5,
        xintercept = c(
            mu,
            muxbar,
            mu + c(1,-1)*sem,
            muxbar + c(1,-1)*sxbar),
        colour = c("red", "blue", "green4", "green4", "gold4", "gold4"),
        lty = c(1, 2, 1, 1, 2, 2)) +
    annotate(
        "text",
        size = 4,
        alpha = 0.8,
        x = c(
            mu, muxbar, mu - sem,
            muxbar + sxbar),
        y = c(0.2, 0.3, 0.5, 0.1),
        hjust = c(
            -0.06, 1.06,
            1.06,
            1.06),
        colour = c("red", "blue", "green4", "gold4"),
        label = c(
            paste0("Population\nMean (", mu, ")"),
            paste0("Mean of Sample\nMeans (", round(muxbar,3), ")"),
            paste0("Standard Error of\nthe Mean\n(+/- ", round(sem,3), ")"),
            paste0("Standard\nDeviation of\nSample Means\n(+/- ", round(sxbar,3),")")))+
    ggtitle(paste(
        "Figure 2: Distribution of the means of", numsims, "samples of", n,
        "\nrexp distribution variables (lambda=", lambda, ")")) +
    theme(plot.title = element_text(size = rel(2)))

print(g2)

```
Whereas the sample of random exponential values followed the expected exponential distribution, figure 2 shows that these sample means follows a normal distribution. It also shows that the mean of the sample means is very close to the population mean and that the standard deviation of the sample means is very close to the expected value, the standard error of the mean.

The standard deviation of sample means (`r round(sxbar, 3)`) is significantly smaller than the population standard deviation (`r round(sigma, 3)`). This will be due to most of the sample variance being essentially discarded when we take a mean of the samples values.